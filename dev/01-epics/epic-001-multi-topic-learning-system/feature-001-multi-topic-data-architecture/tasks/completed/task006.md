# Task006: å®ç°å­¦ä¹ åœ°å›¾ç”ŸæˆåŠŸèƒ½ (ap m å‘½ä»¤)

### **é«˜æ•ˆå¼€å‘ä»»åŠ¡æ¨¡æ¿ (Task Template)**

#### ğŸ¯ **1. ä»»åŠ¡ç›®æ ‡ (Task Goal)**

*ï¼ˆç”¨ä¸€å¥è¯æ¸…æ™°æè¿°æœ¬æ¬¡ä»»åŠ¡è¦è¾¾æˆçš„æœ€ç»ˆä¸šåŠ¡ç›®æ ‡ï¼‰*
> å®ç° `ap m <topic>` å‘½ä»¤ï¼Œç”¨äºå°†å®è§‚ä¸»é¢˜æ‹†è§£ä¸ºç»“æ„åŒ–å­¦ä¹ è·¯å¾„ï¼Œç”ŸæˆåŒ…å«æ‰€æœ‰å­æ¦‚å¿µçš„å­¦ä¹ åœ°å›¾å¹¶å­˜å‚¨åˆ° `concept_map.json` æ–‡ä»¶ä¸­ã€‚

#### ğŸ“ **2. å‰ç½®æ¡ä»¶ (Prerequisites)**

*ï¼ˆæ‰§è¡Œæ­¤ä»»åŠ¡å‰å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼‰*

- [ ] è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ã€‚
- [ ] `requirements.txt` ä¸­çš„æ‰€æœ‰ä¾èµ–å·²å®‰è£…ã€‚
- [ ] `ap --help` å‘½ä»¤å¯æ­£å¸¸æ‰§è¡Œã€‚
- [ ] DeepSeek API å¯†é’¥å·²æ­£ç¡®é…ç½®åœ¨ `.env` æ–‡ä»¶ä¸­ã€‚
- [ ] `workspace/` ç›®å½•ç»“æ„å·²åˆ›å»ºã€‚

#### ğŸ’» **3. æŠ€æœ¯è§„æ ¼ (Technical Specifications)**

- **å‘½ä»¤æ¥å£ (Command Interface):**
  - **å‘½ä»¤**: `m`, `map`
  - **å‚æ•°**: `topic` (å­—ç¬¦ä¸², å¿…éœ€)
  - **åŠŸèƒ½**: `ap m "Python Core Syntax"`
  - **åˆ«åæ”¯æŒ**: ç”¨æˆ·å¯ä»¥ä½¿ç”¨ `ap map "Python Core Syntax"` ä½œä¸ºç­‰ä»·å‘½ä»¤

- **æ–‡ä»¶ç»“æ„ (File Structure):**
  - **è¯»å–**: æ— ï¼ˆé¦–æ¬¡åˆ›å»ºï¼‰æˆ– `workspace/concept_map.json`ï¼ˆæ›´æ–°ç°æœ‰åœ°å›¾ï¼‰
  - **å†™å…¥**: `workspace/concept_map.json`
  - **ç›®å½•åˆ›å»º**: ç¡®ä¿ `workspace/` ç›®å½•å­˜åœ¨

- **æ ¸å¿ƒé€»è¾‘ (Core Logic):**
    1. **å‘½ä»¤æ³¨å†Œ**: åœ¨ `ap/cli.py` ä¸­æ·»åŠ  `generate_map` å‡½æ•°ï¼Œå¹¶æ³¨å†Œä¸º `m` å’Œ `map` å‘½ä»¤ã€‚
    2. **è¾“å…¥å¤„ç†**: æ¥æ”¶ `topic` å‚æ•°ï¼Œä½¿ç”¨ slugify è§„åˆ™è½¬æ¢ä¸ºæ¦‚å¿µIDï¼ˆå°å†™ï¼Œè¿å­—ç¬¦æ›¿æ¢ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ï¼‰ã€‚
    3. **AI æç¤ºè®¾è®¡**: æ„å»ºä¸“é—¨çš„ Promptï¼Œè¦æ±‚ AI å°†ä¸»é¢˜æ‹†è§£ä¸ºå±‚çº§åŒ–çš„å­æ¦‚å¿µç»“æ„ã€‚
    4. **API è°ƒç”¨**: è°ƒç”¨ DeepSeek API è·å–ç»“æ„åŒ–çš„æ¦‚å¿µåˆ†è§£ç»“æœã€‚
    5. **æ•°æ®è§£æ**: è§£æ AI è¿”å›çš„ç»“æœï¼Œæ„å»ºç¬¦åˆ `concept_map.json` æ ¼å¼çš„æ•°æ®ç»“æ„ã€‚
    6. **æ–‡ä»¶æ“ä½œ**:
        - å¦‚æœ `concept_map.json` ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶
        - å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆå¹¶æ–°æ¦‚å¿µåˆ°ç°æœ‰åœ°å›¾ä¸­
        - ä¿å­˜æ›´æ–°åçš„å®Œæ•´æ¦‚å¿µåœ°å›¾

- **æ•°æ®ç»“æ„è®¾è®¡**:

    ```json
    {
      "python-core-syntax": {
        "name": "Python Core Syntax",
        "children": [
          "variables-and-data-types",
          "control-flow", 
          "functions-and-scope",
          "data-structures"
        ],
        "status": {
          "explained": false,
          "quiz_generated": false
        },
        "mastery": {
          "best_score_percent": -1
        }
      }
    }
    ```

- **AI Prompt è®¾è®¡**:

    ```
    è¯·å°†ä»¥ä¸‹ä¸»é¢˜æ‹†è§£ä¸ºç»“æ„åŒ–çš„å­¦ä¹ è·¯å¾„ã€‚è¿”å›ä¸€ä¸ªJSONæ ¼å¼çš„æ¦‚å¿µåœ°å›¾ï¼ŒåŒ…å«ä¸»æ¦‚å¿µå’Œæ‰€æœ‰å­æ¦‚å¿µã€‚

    è¦æ±‚ï¼š
    1. ä¸»æ¦‚å¿µåº”è¯¥åŒ…å«æ ¸å¿ƒå­æ¦‚å¿µ
    2. æ¯ä¸ªå­æ¦‚å¿µåº”è¯¥æ˜¯ç‹¬ç«‹å¯å­¦ä¹ çš„çŸ¥è¯†ç‚¹
    3. å¦‚æœ‰å¿…è¦ï¼Œè¯·åˆ›ç«‹å­™æ¦‚å¿µã€‚
    4. æ¦‚å¿µåç§°è¦å…·ä½“æ˜ç¡®ï¼Œé¿å…è¿‡äºå®½æ³›
    5. æŒ‰å­¦ä¹ çš„é€»è¾‘é¡ºåºæ’åˆ—å­æ¦‚å¿µ
    6. ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼Œä¸è¦åŒ…å«ä»»ä½•é¢å¤–çš„è§£é‡Šæ–‡å­—

    ä¸»é¢˜: {topic}

    è¿”å›æ ¼å¼ç¤ºä¾‹ï¼š
    {
      "main_concept": "Python Core Syntax",
      "children": [
        "Variables and Data Types",
        "Control Flow",
        "Functions and Scope",
        "Data Structures"
      ]
    }
    ```

- **é”™è¯¯å¤„ç†**:
  - API è°ƒç”¨å¤±è´¥æ—¶çš„é‡è¯•æœºåˆ¶
  - JSON è§£æé”™è¯¯çš„å¤„ç†
  - æ–‡ä»¶è¯»å†™æƒé™é—®é¢˜çš„å¤„ç†
  - æ— æ•ˆä¸»é¢˜è¾“å…¥çš„éªŒè¯

- **ä¾èµ–å˜æ›´ (Dependencies):**
  - ç¡®ä¿ `json` æ¨¡å—ï¼ˆPython å†…ç½®ï¼‰
  - ç¡®ä¿ `pathlib` æ¨¡å—ï¼ˆPython å†…ç½®ï¼‰
  - ç¡®ä¿ `deepseek` åº“å·²åœ¨ `requirements.txt` ä¸­
  - ç¡®ä¿ `python-dotenv` åº“å·²åœ¨ `requirements.txt` ä¸­

#### âœ… **4. éªŒæ”¶æ ‡å‡† (Acceptance Criteria)**

*ï¼ˆä¸€ä¸ªå¯æ‰§è¡Œçš„ã€ç”¨äºéªŒè¯ä»»åŠ¡æ˜¯å¦å®Œæˆçš„æ¸…å•ï¼‰*

- [ ] **å‘½ä»¤æ³¨å†ŒæˆåŠŸ**ï¼šè¿è¡Œ `ap --help`ï¼Œè¾“å‡ºä¸­åº”åŒ…å« `m, map` å‘½ä»¤åŠå…¶æè¿°ã€‚
- [ ] **å‚æ•°éªŒè¯**ï¼šè¿è¡Œ `ap m` ï¼ˆæ— å‚æ•°ï¼‰ï¼Œåº”æ˜¾ç¤ºæ¸…æ™°çš„é”™è¯¯æç¤ºè¦æ±‚æä¾›ä¸»é¢˜ã€‚
- [ ] **åŠŸèƒ½æ‰§è¡ŒæˆåŠŸ**ï¼šè¿è¡Œ `ap m "Python Core Syntax"`ï¼Œå‘½ä»¤æˆåŠŸé€€å‡ºï¼Œå¹¶æ‰“å°æˆåŠŸæ¶ˆæ¯ã€‚
- [ ] **æ–‡ä»¶åˆ›å»ºéªŒè¯**ï¼š
  - [ ] `workspace/` ç›®å½•è¢«åˆ›å»ºï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ã€‚
  - [ ] `workspace/concept_map.json` æ–‡ä»¶è¢«åˆ›å»ºã€‚
  - [ ] æ–‡ä»¶å†…å®¹æ˜¯åˆæ³•çš„ JSON æ ¼å¼ã€‚
- [ ] **æ•°æ®ç»“æ„éªŒè¯**ï¼š
  - [ ] JSON åŒ…å«ä¸»æ¦‚å¿µçš„å®Œæ•´ä¿¡æ¯ï¼ˆname, children, status, masteryï¼‰ã€‚
  - [ ] æ‰€æœ‰å­æ¦‚å¿µéƒ½æœ‰å¯¹åº”çš„æ¡ç›®ã€‚
  - [ ] æ¦‚å¿µID ä½¿ç”¨æ­£ç¡®çš„ slugify æ ¼å¼ã€‚
  - [ ] åˆå§‹çŠ¶æ€è®¾ç½®æ­£ç¡®ï¼ˆexplained: false, quiz_generated: false, best_score_percent: -1ï¼‰ã€‚
- [ ] **åˆå¹¶åŠŸèƒ½éªŒè¯**ï¼š
  - [ ] è¿è¡Œç¬¬äºŒä¸ªä¸»é¢˜ `ap m "JavaScript Basics"`ï¼Œæ–°æ¦‚å¿µåº”æ·»åŠ åˆ°ç°æœ‰æ–‡ä»¶ä¸­ã€‚
  - [ ] åŸæœ‰æ¦‚å¿µæ•°æ®ä¸åº”è¢«è¦†ç›–ã€‚
- [ ] **åˆ«åå‘½ä»¤éªŒè¯**ï¼šè¿è¡Œ `ap map "Test Topic"`ï¼ŒåŠŸèƒ½åº”ä¸ `ap m "Test Topic"` å®Œå…¨ç›¸åŒã€‚

#### â“ **5. æ½œåœ¨é£é™© (Potential Risks)**

*ï¼ˆé¢„åˆ¤å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼‰*
> **æŠ€æœ¯é£é™©**ï¼š
>
> - AI è¿”å›çš„ JSON æ ¼å¼å¯èƒ½ä¸ç¨³å®šï¼Œéœ€è¦åšé€‚å½“çš„è§£æé”™è¯¯å¤„ç†å’Œæ ¼å¼éªŒè¯ã€‚
> - å¯¹äºè¿‡äºå¤æ‚æˆ–æ¨¡ç³Šçš„ä¸»é¢˜ï¼ŒAI å¯èƒ½æ— æ³•ç”Ÿæˆåˆç†çš„å­æ¦‚å¿µåˆ†è§£ã€‚
> - æ¦‚å¿µID çš„ slugify è½¬æ¢å¯èƒ½äº§ç”Ÿé‡å¤æˆ–å†²çªçš„æ ‡è¯†ç¬¦ã€‚
>
> **ä¸šåŠ¡é£é™©**ï¼š
>
> - ç”¨æˆ·è¾“å…¥çš„ä¸»é¢˜å¯èƒ½è¿‡äºå®½æ³›ï¼ˆå¦‚"ç¼–ç¨‹"ï¼‰ï¼Œå¯¼è‡´ç”Ÿæˆçš„å­¦ä¹ è·¯å¾„ä¸å¤Ÿå…·ä½“ã€‚
> - ä¸åŒç”¨æˆ·å¯¹åŒä¸€ä¸»é¢˜çš„ç†è§£å’Œå­¦ä¹ è·¯å¾„åå¥½å¯èƒ½ä¸åŒã€‚
>
> **æ•°æ®é£é™©**ï¼š
>
> - `concept_map.json` æ–‡ä»¶æŸåå¯èƒ½å¯¼è‡´æ•´ä¸ªå­¦ä¹ è¿›åº¦ä¸¢å¤±ã€‚
> - å¹¶å‘è®¿é—®å¯èƒ½å¯¼è‡´æ–‡ä»¶å†™å…¥å†²çªã€‚

#### ğŸ”§ **6. å®ç°ç»†èŠ‚è¡¥å…… (Implementation Details)**

- **Slugify å‡½æ•°å®ç°**:

    ```python
    import re
    
    def slugify(text: str) -> str:
        """å°†æ–‡æœ¬è½¬æ¢ä¸ºæ–‡ä»¶ç³»ç»Ÿå‹å¥½çš„æ ‡è¯†ç¬¦"""
        # è½¬ä¸ºå°å†™
        text = text.lower()
        # æ›¿æ¢ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ä¸ºè¿å­—ç¬¦
        text = re.sub(r'[^\w\s-]', '', text)
        text = re.sub(r'[-\s]+', '-', text)
        # å»é™¤é¦–å°¾è¿å­—ç¬¦
        return text.strip('-')
    ```

- **æ¦‚å¿µåœ°å›¾ç®¡ç†ç±»è®¾è®¡**:

    ```python
    class ConceptMap:
        def __init__(self, file_path: str):
            self.file_path = Path(file_path)
            self.data = self.load()
        
        def load(self) -> dict:
            """åŠ è½½ç°æœ‰æ¦‚å¿µåœ°å›¾"""
            
        def save(self) -> None:
            """ä¿å­˜æ¦‚å¿µåœ°å›¾åˆ°æ–‡ä»¶"""
            
        def add_concept(self, concept_id: str, concept_data: dict) -> None:
            """æ·»åŠ æ–°æ¦‚å¿µåˆ°åœ°å›¾"""
            
        def update_status(self, concept_id: str, status_key: str, value: any) -> None:
            """æ›´æ–°æ¦‚å¿µçŠ¶æ€"""
    ```

- **æˆåŠŸè¾“å‡ºç¤ºä¾‹**:

    ```
    ğŸ—ºï¸  å­¦ä¹ åœ°å›¾ç”ŸæˆæˆåŠŸï¼
    
    ä¸»é¢˜: Python Core Syntax
    â””â”€â”€ åŒ…å« 4 ä¸ªå­æ¦‚å¿µ:
        â”œâ”€â”€ Variables and Data Types
        â”œâ”€â”€ Control Flow  
        â”œâ”€â”€ Functions and Scope
        â””â”€â”€ Data Structures
    
    ğŸ’¾ æ¦‚å¿µåœ°å›¾å·²ä¿å­˜åˆ°: workspace/concept_map.json
    ğŸ’¡ ä½¿ç”¨ 'ap t' æŸ¥çœ‹å®Œæ•´å­¦ä¹ ä»ªè¡¨ç›˜
    ```
